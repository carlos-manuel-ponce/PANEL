<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Designación de Cargos Jerárquicos &gt; Salón Islas Malvinas</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <style>
    :root{
      --bg: #f8fafc;
      --panel: #f4f8fb;
      --card: #ffffff;
      --brand-primary: #3B82F6;
      --brand-secondary: #8B5CF6;
      --brand-light: #e8f1f8;
      --celeste-light: #bae6fd;
      --text-primary: #1F2937;
      --text-secondary: #6B7280;
      --text-muted: #94a3b8;
      --seat: #e8f1f8;
      --seat-border: #e2e8f0;
      --present: #22c55e;
      --absent: #ef4444;
      --role-jurado: #8B5CF6;
      --role-funcionario: #3B82F6;
      --role-ministro: #F97316;
      --role-custodia: #1F2937;
      --shadow-sm: 0 1px 2px rgba(59,101,163,0.05);
      --shadow: 0 4px 12px rgba(59,101,163,0.1);
      --shadow-lg: 0 8px 25px rgba(59,101,163,0.15);
      --accent: #8B5CF6;
      --brand: #3B82F6;
    }
    body{
      margin:0;
      background:linear-gradient(135deg, #f8fafc 0%, #e8f1f8 30%, #f4f8fb 70%, #e8f1f8 100%);
      font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text-primary);
    }
    header{
      position:sticky;
      top:0;
      z-index:30;
      background:linear-gradient(135deg, #f8fafc 0%, #e8f1f8 100%);
      border-bottom:3px solid var(--brand-secondary);
      box-shadow:0 4px 20px rgba(59,101,163,0.08),0 1px 3px rgba(0,0,0,0.06);
    }
    .wrap{
      max-width:1400px;
      margin:0 auto;
      padding:18px 24px;
    }
    .topbar{
      display:flex;
      align-items:center;
      gap:18px;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .metrics{
      display:flex;
      gap:24px;
      justify-content:center;
      align-items:center;
    }
    .kpi{
      min-width:120px;
      padding:12px 18px;
      background:linear-gradient(135deg, #56B4C6 0%, #56B4C6 100%);
      border-radius:16px;
      box-shadow:var(--shadow-sm);
      text-align:center;
      color:#fff;
      font-weight:700;
      font-size:1.1rem;
      border:2px solid var(--brand-light);
    }
    .kpi .label{
      font-size:.95rem;
      color:#fff;
      font-weight:700;
      display:block;
      margin-bottom:4px;
      letter-spacing:0.5px;
    }
    .kpi .val{
      font-size:1.3rem;
      font-weight:800;
      color:#fff;
      text-shadow:0 2px 8px rgba(59,101,163,0.12);
    }
    .content{
      display:grid;
      grid-template-columns:320px 1fr;
      gap:32px;
      padding:32px;
      background:var(--bg);
    }
    .side{
      background:var(--panel);
      border-radius:20px;
      padding:24px;
      box-shadow:var(--shadow-sm);
      position:sticky;
      top:90px;
      align-self:flex-start;
      z-index:10;
      border:2px solid var(--brand-light);
    }
    .side h3{
      margin:8px 0 20px;
      font-size:1.1rem;
      color:#3B65A3;
      font-weight:800;
      border-bottom:2px solid var(--brand-light);
      padding-bottom:12px;
      letter-spacing:0.5px;
    }
    .system-title {
      color: #3B65A3 !important;
    }
    .stage-label {
      color: #3B65A3 !important;
    }
    .sector-title {
      color: #3B65A3 !important;
    }
    .legend{
      display:grid;
      grid-template-columns:1fr auto;
      row-gap:10px;
      column-gap:14px;
      font-size:.95rem;
      margin-bottom:20px;
    }
    .dot{
      width:16px;
      height:16px;
      border-radius:6px;
      border:2px solid var(--brand-light);
      box-shadow:var(--shadow-sm);
    }
    .muted{
      color:var(--text-secondary);
      font-size:.95rem;
      font-weight:600;
    }
    .controls{display:grid;gap:14px;margin-top:16px}
    .controls input[type="text"], .controls select{width:100%;padding:14px 16px;border-radius:14px;border:2px solid var(--brand-light);background:var(--card);color:var(--text-primary);outline:none;font-size:14px;font-weight:500;box-shadow:var(--shadow-sm)}
    .controls input::placeholder{color:var(--text-muted)}
    .controls input:focus, .controls select:focus{border-color:var(--brand-secondary);box-shadow:0 0 0 3px rgba(86,180,198,0.15)}
    button.btn{
      appearance:none;
      border:none;
      border-radius:14px;
      padding:14px 18px;
      font-weight:700;
      color:#fff;
      background:linear-gradient(135deg,#56B4C6 0%,#56B4C6 100%);
      cursor:pointer;
      transition:all .2s ease;
      font-size:14px;
      box-shadow:var(--shadow-sm)
    }
    button.btn:hover{box-shadow:var(--shadow);transform:translateY(-2px)}
    button.secondary{background:var(--card);color:var(--brand-primary);border:2px solid var(--brand-light);box-shadow:var(--shadow-sm)}
    .stage{
      background:var(--card);
      border:2px solid var(--brand-light);
      border-radius:20px;
      padding:24px;
      position:relative;
      box-shadow:var(--shadow-sm);
    }
    .stage-head{
      display:flex;
      align-items:center;
      gap:24px;
      justify-content:space-between;
      margin-bottom:18px;
      flex-wrap:wrap;
      padding-bottom:16px;
      border-bottom:2px solid var(--brand-light);
    }
    .stage-label{
      font-weight:800;
      color:var(--brand-primary);
      font-size:1.3rem;
      letter-spacing:0.5px;
    }
    .zoom{display:flex;gap:10px;align-items:center}
    .zoom input[type="range"]{width:160px;accent-color:var(--brand-secondary)}
    .connection-status{font-size:13px;color:var(--present);display:flex;align-items:center;gap:8px;background:var(--brand-light);padding:8px 12px;border-radius:12px;font-weight:600}
    .connection-dot{width:10px;height:10px;background:var(--present);border-radius:50%;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.5;}}
    .sectors{display:grid;gap:20px}
    .sector{background:var(--card);border-radius:16px;padding:20px;border:2px solid var(--brand-light);border-top:4px solid var(--brand-secondary);box-shadow:var(--shadow-sm);position:relative;}
    .sector-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .sector-title{font-weight:800;font-size:1.1rem;color:var(--brand-primary)}
    .sector-info{color:var(--text-secondary);font-size:0.9rem;font-weight:500}
    .grid{--size:32px;display:grid;grid-template-columns:repeat(10,var(--size));gap:10px;justify-content:center;margin:12px 0}
    .seat{width:var(--size);height:var(--size);background:transparent;border:none;display:grid;place-items:center;font-size:.7rem;color:var(--text-secondary);font-weight:800;user-select:none;cursor:pointer;transition:all .2s ease;position:relative;transform-style:preserve-3d;}
    .seat::before{content:'';position:absolute;top:2px;left:50%;transform:translateX(-50%);width:88%;height:45%;background:linear-gradient(145deg,var(--seat) 0%,rgba(241,245,249,0.8) 100%);border:2px solid var(--seat-border);border-radius:50% 50% 10px 10px;box-shadow:0 3px 8px rgba(0,0,0,0.1),inset 0 1px 2px rgba(255,255,255,0.8),inset 0 -1px 2px rgba(0,0,0,0.1);z-index:1;}
    .seat::after{content:'';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:78%;height:48%;background:linear-gradient(145deg,var(--seat) 0%,rgba(241,245,249,0.9) 100%);border:2px solid var(--seat-border);border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.15),inset 0 1px 3px rgba(255,255,255,0.7),inset 0 -2px 4px rgba(0,0,0,0.1);z-index:1;}
    .seat:hover{transform:translateY(-4px) scale(1.05);z-index:10}
    .seat:hover::before{box-shadow:0 6px 20px rgba(0,0,0,0.2),inset 0 2px 4px rgba(255,255,255,0.9),inset 0 -2px 3px rgba(0,0,0,0.15) !important;}
    .seat:hover::after{box-shadow:0 8px 25px rgba(0,0,0,0.25),inset 0 2px 5px rgba(255,255,255,0.8),inset 0 -3px 6px rgba(0,0,0,0.2) !important;}
    .seat.presente{color:#fff}
    .seat.presente::before{background:linear-gradient(145deg,var(--present) 0%,rgba(34,197,94,0.9) 100%) !important;border-color:#16a34a !important;box-shadow:0 3px 15px rgba(34,197,94,0.5),inset 0 1px 3px rgba(255,255,255,0.4),inset 0 -1px 3px rgba(22,163,74,0.3) !important;}
    .seat.presente::after{background:linear-gradient(145deg,var(--present) 0%,rgba(34,197,94,0.95) 100%) !important;border-color:#16a34a !important;box-shadow:0 4px 18px rgba(34,197,94,0.6),inset 0 1px 4px rgba(255,255,255,0.3),inset 0 -2px 4px rgba(22,163,74,0.4) !important;}
    .seat.absent{color:#fff}
    .seat.absent::before{background:linear-gradient(145deg,var(--absent) 0%,rgba(239,68,68,0.9) 100%) !important;border-color:#dc2626 !important;box-shadow:0 3px 15px rgba(239,68,68,0.5),inset 0 1px 3px rgba(255,255,255,0.3),inset 0 -1px 3px rgba(220,38,38,0.3) !important;}
    .seat.absent::after{background:linear-gradient(145deg,var(--absent) 0%,rgba(239,68,68,0.95) 100%) !important;border-color:#dc2626 !important;box-shadow:0 4px 18px rgba(239,68,68,0.6),inset 0 1px 4px rgba(255,255,255,0.25),inset 0 -2px 4px rgba(220,38,38,0.4) !important;}
    .seat.highlight{outline:3px solid var(--brand-secondary);outline-offset:3px;z-index:10;position:relative;box-shadow:0 0 20px rgba(86,180,198,0.5)}
    .seat.color-violeta{color:#fff !important}
    .seat.color-violeta::before{background:linear-gradient(145deg,var(--role-jurado) 0%,rgba(139,92,246,0.9) 100%) !important;border-color:#7C3AED !important;box-shadow:0 3px 12px rgba(139,92,246,0.4),inset 0 1px 3px rgba(255,255,255,0.3),inset 0 -1px 3px rgba(124,58,237,0.3) !important;}
    .seat.color-violeta::after{background:linear-gradient(145deg,var(--role-jurado) 0%,rgba(139,92,246,0.95) 100%) !important;border-color:#7C3AED !important;box-shadow:0 4px 15px rgba(139,92,246,0.5),inset 0 1px 4px rgba(255,255,255,0.25),inset 0 -2px 4px rgba(124,58,237,0.4) !important;}
    .seat.color-azul{color:#fff !important}
    .seat.color-azul::before{background:linear-gradient(145deg,var(--role-funcionario) 0%,rgba(59,101,163,0.9) 100%) !important;border-color:var(--brand-primary) !important;box-shadow:0 3px 12px rgba(59,101,163,0.4),inset 0 1px 3px rgba(255,255,255,0.3),inset 0 -1px 3px rgba(59,101,163,0.3) !important;}
    .seat.color-azul::after{background:linear-gradient(145deg,var(--role-funcionario) 0%,rgba(59,101,163,0.95) 100%) !important;border-color:var(--brand-primary) !important;box-shadow:0 4px 15px rgba(59,101,163,0.5),inset 0 1px 4px rgba(255,255,255,0.25),inset 0 -2px 4px rgba(59,101,163,0.4) !important;}
    .seat.color-naranja{color:#fff !important}
    .seat.color-naranja::before{background:linear-gradient(145deg,var(--role-ministro) 0%,rgba(249,115,22,0.9) 100%) !important;border-color:#EA580C !important;box-shadow:0 3px 12px rgba(249,115,22,0.4),inset 0 1px 3px rgba(255,255,255,0.3),inset 0 -1px 3px rgba(234,88,12,0.3) !important;}
    .seat.color-naranja::after{background:linear-gradient(145deg,var(--role-ministro) 0%,rgba(249,115,22,0.95) 100%) !important;border-color:#EA580C !important;box-shadow:0 4px 15px rgba(249,115,22,0.5),inset 0 1px 4px rgba(255,255,255,0.25),inset 0 -2px 4px rgba(234,88,12,0.4) !important;}
    .seat.color-negro{color:#fff !important}
    .seat.color-negro::before{background:linear-gradient(145deg,var(--role-custodia) 0%,rgba(31,41,55,0.9) 100%) !important;border-color:#111827 !important;box-shadow:0 3px 12px rgba(31,41,55,0.4),inset 0 1px 3px rgba(255,255,255,0.2),inset 0 -1px 3px rgba(17,24,39,0.5) !important;}
    .seat.color-negro::after{background:linear-gradient(145deg,var(--role-custodia) 0%,rgba(31,41,55,0.95) 100%) !important;border-color:#111827 !important;box-shadow:0 4px 15px rgba(31,41,55,0.6),inset 0 1px 4px rgba(255,255,255,0.15),inset 0 -2px 4px rgba(17,24,39,0.6) !important;}
    .seat.empty-seat{color:transparent;cursor:default;opacity:1;position:relative}
    .seat.empty-seat:hover{transform:none}
    .seat.empty-seat::before{background:var(--brand-light);border-color:var(--celeste-light)}
    .seat.empty-seat::after{background:var(--brand-light);border-color:var(--celeste-light)}
    .seat-num{position:relative;top:0;left:0;transform:none;font-size:1.1rem;color:var(--brand-primary);font-weight:bold;z-index:2;pointer-events:none;text-shadow:0 1px 4px #fff,0 0px 2px #e8f1f8;display:flex;align-items:center;justify-content:center;height:100%;}
    .badge{display:inline-flex;align-items:center;gap:8px;background:var(--brand-light);border:2px solid var(--celeste-light);color:var(--brand-primary);padding:8px 14px;border-radius:999px;font-size:.75rem;font-weight:600;box-shadow:var(--shadow-sm);transition:all .2s ease}
    .badge:hover{border-color:var(--brand-secondary);box-shadow:var(--shadow);transform:translateY(-1px)}
    .role-dot{width:12px;height:12px;border-radius:4px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    dialog{border:none;border-radius:24px;background:var(--card);color:var(--text-primary);padding:0;max-width:550px;width:90%;box-shadow:var(--shadow-lg);display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999;overflow:hidden;border:3px solid var(--brand-light);}
    dialog.show{display:block;}
    .modal-header{background:linear-gradient(135deg,var(--brand-primary),var(--brand-secondary));color:#fff;padding:24px 28px;text-align:center}
    .modal-header h3{margin:0;font-size:1.3rem;font-weight:800}
    .modal-body{padding:28px}
    #detalleInfo{background:var(--brand-light);border:2px solid var(--celeste-light);padding:24px;border-radius:16px;line-height:1.7;font-size:15px;color:var(--text-primary);}
    .info-grid{display:grid;grid-template-columns:1fr 2fr;gap:16px 20px;align-items:center}
    .info-label{font-weight:700;color:var(--brand-primary)}
    .info-value{color:var(--text-primary);font-weight:500}
    .modal-actions{display:flex;justify-content:center;margin-top:24px;}
    .overlay{position:fixed;inset:0;background:rgba(59,101,163,0.4);display:none;z-index:998;backdrop-filter:blur(4px)}
    .overlay.show{display:block;}
    @media(max-width:1200px){.content{grid-template-columns:1fr;gap:16px}.side{order:2}.stage{order:1}}
    @media(max-width:768px){.topbar{flex-direction:column;gap:12px;text-align:center}.brand{justify-content:center}.metrics{justify-content:center}.wrap{padding:12px 16px}.header-logo{width:65px;height:65px}.content{padding:0 16px}.stage-head{flex-direction:column;align-items:stretch;gap:12px}}
    @media(max-width:480px){.grid{--size:24px;gap:4px}.seat{font-size:.6rem}.sector{padding:12px}.modal-body{padding:16px}}
  </style>
</head>
<body>
</body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <div class="title">
          <p class="institution">Ministerio de Educación</p>
          <h1 class="system-title">Designación de Cargos Jerárquicos &gt; Salón Islas Malvinas</h1>
        </div>
      </div>
      <div class="metrics" id="metrics">
        <div class="kpi"><span class="label">Total Registrados</span><span class="val" id="kpi-total">0</span></div>
        <div class="kpi"><span class="label">Presentes</span><span class="val" id="kpi-present">0</span></div>
        <div class="kpi"><span class="label">Ausentes</span><span class="val" id="kpi-absent">0</span></div>
        <div class="kpi"><span class="label">Ocupación</span><span class="val" id="kpi-ocupa">0%</span></div>
      </div>
    </div>
  </header>
  <main class="content">
    <aside class="side">
    .metrics-panel {
      width: 100%;
      margin: 0 0 24px 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .metrics {
      display: flex;
      gap: 32px;
      width: 100%;
      justify-content: center;
      align-items: stretch;
    }
    .kpi {
      flex: 1 1 0;
      min-width: 0;
      max-width: 220px;
      height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #56B4C6 0%, #56B4C6 100%);
      border-radius: 18px;
      box-shadow: var(--shadow-sm);
      text-align: center;
      color: #fff;
      font-weight: 700;
      font-size: 1.1rem;
      border: 2px solid var(--brand-light);
      margin: 0 0;
    }
    .kpi .label {
      font-size: 1rem;
      color: #fff;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
      letter-spacing: 0.5px;
    }
    .kpi .val {
      font-size: 1.5rem;
      font-weight: 800;
      color: #fff;
      text-shadow: 0 2px 8px rgba(59,101,163,0.12);
    }
      <h3>Estado de Asistencia</h3>
      <div class="legend">
        <div class="muted">Disponible</div>
        <div class="dot" style="background:var(--seat)"></div>
        <div class="muted">Presente</div>
        <div class="dot" style="background:var(--present)"></div>
        <div class="muted">Ausente</div>
        <div class="dot" style="background:var(--absent)"></div>
      </div>
      <h3>Referencias</h3>
      <div class="legend">
        <div class="muted">Jurados</div>
        <div class="dot" style="background:#8B5CF6"></div>
        <div class="muted">Funcionarios</div>
        <div class="dot" style="background:#3B82F6"></div>
        <div class="muted">Ministro</div>
        <div class="dot" style="background:#F97316"></div>
        <div class="muted">Custodia</div>
        <div class="dot" style="background:#1F2937"></div>
      </div>
      <div class="controls">
        <input id="search" type="text" placeholder="Buscar por asiento (ej: 150)" />
        <select id="filter">
          <option value="all">Ver: Todos</option>
          <option value="present">Solo presentes</option>
          <option value="absent">Solo ausentes</option>
          <option value="empty">Solo disponibles</option>
        </select>
        <button class="btn" id="btnRefresh">Actualizar Datos</button>
      </div>
    </aside>
    <section class="stage">
      <div class="stage-head">
        <div class="stage-label">Plano de Asientos - 260 Ubicaciones</div>
        <div class="zoom">
          <span class="muted">Tamaño</span>
          <input id="zoom" type="range" min="24" max="48" value="32" />
        </div>
        <button class="btn secondary" id="btnVistaJunta" style="margin-left:20px;">Vista Sectores Juntos</button>
      </div>
      <div class="sectors" id="sectors"></div>
      <div class="sectors-juntas" id="sectorsJuntas" style="display:none; margin-top:30px;">
        <div style="display:flex; gap:60px; justify-content:center; align-items:flex-start;">
          <div id="sector1Junta"></div>
          <div style="width:40px;"></div>
          <div id="sector2Junta"></div>
        </div>
      </div>
      <p class="muted" style="margin-top:12px;text-align:center;font-size:0.85rem">
        Organización: <strong>2 sectores de 10 columnas × 13 filas</strong> | Total: <strong>260 asientos</strong> | Actualización: <strong>Tiempo real</strong>
      </p>
    </section>
  </main>
  <div class="overlay" id="overlay"></div>
  <dialog id="modalDetalle">
    <div class="modal-header">
      <h3>Información del Asistente</h3>
    </div>
    <div class="modal-body">
      <div id="detalleInfo"></div>
      <div class="modal-actions">
        <button id="cerrarModal" class="btn">Cerrar</button>
      </div>
    </div>
  </dialog>
</body>
<script>
// Configuración Supabase
const SUPABASE_URL = 'https://csbcfhwdpstnofvsfqwh.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzYmNmaHdkcHN0bm9mdnNmcXdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMjkzODcsImV4cCI6MjA3MTcwNTM4N30.lX166U64tFeqKd6snFduL-oXWD_LXwzPMyQYVF3g8ek';
const supabaseClient = window.supabase;
const supabase = supabaseClient.createClient(SUPABASE_URL, SUPABASE_KEY);
let dataAsistencia = {};
let vistaJuntaActiva = false;
const btnVistaJunta = document.getElementById('btnVistaJunta');
const sectorsEl = document.getElementById('sectors');
const kpiTotal = document.getElementById('kpi-total');
const kpiPresent = document.getElementById('kpi-present');
const kpiAbsent = document.getElementById('kpi-absent');
const kpiOcupa = document.getElementById('kpi-ocupa');
const detalleInfo = document.getElementById('detalleInfo');
const modalDetalle = document.getElementById('modalDetalle');
const overlay = document.getElementById('overlay');
const cerrarModal = document.getElementById('cerrarModal');
// Configuración de sectores
const SECTORES = [
  { id: 1, titulo: 'Sector 1', inicio: 1, fin: 130 },
  { id: 2, titulo: 'Sector 2', inicio: 131, fin: 260 }
];
// Alternador de vistas
btnVistaJunta.addEventListener('click', () => {
  if (!vistaJuntaActiva) {
    document.getElementById('sectors').style.display = 'none';
    document.getElementById('sectorsJuntas').style.display = 'block';
    renderSectoresJuntos();
    btnVistaJunta.textContent = 'Vista Sectores Separados';
  } else {
    document.getElementById('sectorsJuntas').style.display = 'none';
    document.getElementById('sectors').style.display = 'grid';
    crearSectores();
    btnVistaJunta.textContent = 'Vista Sectores Juntos';
  }
  vistaJuntaActiva = !vistaJuntaActiva;
});
// Renderizar sectores juntos
function renderSectoresJuntos() {
  document.getElementById('sector1Junta').innerHTML = '';
  document.getElementById('sector2Junta').innerHTML = '';
  // Sector 1
  const sector1 = SECTORES[0];
  const grid1 = document.createElement('div');
  grid1.className = 'grid';
  grid1.style.setProperty('--size', document.getElementById('zoom').value + 'px');
  let filaIndex1 = 0;
  for (let i = sector1.inicio; i <= sector1.fin; i += 10) {
    for (let j = i; j < i + 10 && j <= sector1.fin; j++) {
      const seat = document.createElement('div');
      seat.className = 'seat';
      seat.dataset.id = j;
      seat.title = `Asiento ${j}`;
      if (filaIndex1 < 2) {
        seat.textContent = '';
        seat.classList.add('color-azul');
      } else {
        seat.innerHTML = `<span class='seat-num'>${j}</span>`;
        if (filaIndex1 === 12) {
          seat.classList.add('color-azul');
        }
      }
      seat.addEventListener('click', () => mostrarDetalle(seat));
      grid1.appendChild(seat);
    }
    filaIndex1++;
  }
  document.getElementById('sector1Junta').appendChild(grid1);
  // Sector 2
  const sector2 = SECTORES[1];
  const grid2 = document.createElement('div');
  grid2.className = 'grid';
  grid2.style.setProperty('--size', document.getElementById('zoom').value + 'px');
  let filaIndex2 = 0;
  for (let i = sector2.inicio; i <= sector2.fin; i += 10) {
    for (let j = i; j < i + 10 && j <= sector2.fin; j++) {
      const seat = document.createElement('div');
      seat.className = 'seat';
      seat.dataset.id = j;
      seat.title = `Asiento ${j}`;
      if (filaIndex2 === 0) {
        seat.textContent = '';
        seat.classList.add('color-azul');
      } else if (filaIndex2 < 2) {
        seat.textContent = '';
        seat.classList.add('color-azul');
      } else {
        seat.innerHTML = `<span class='seat-num'>${j}</span>`;
        if (filaIndex2 === 12) {
          seat.classList.add('color-azul');
        }
      }
      seat.addEventListener('click', () => mostrarDetalle(seat));
      grid2.appendChild(seat);
    }
    filaIndex2++;
  }
  document.getElementById('sector2Junta').appendChild(grid2);
}
// Renderizar sectores separados
function crearSectores() {
  sectorsEl.innerHTML = '';
  SECTORES.forEach(sector => {
    const sectorDiv = document.createElement('div');
    sectorDiv.className = 'sector';
    const header = document.createElement('div');
    header.className = 'sector-head';
    header.innerHTML = `
      <div class="sector-title">${sector.titulo}</div>
      <div class="sector-info">10 × 13 (${sector.fin - sector.inicio + 1} asientos)</div>
    `;
    const grid = document.createElement('div');
    grid.className = 'grid';
    grid.style.setProperty('--size', document.getElementById('zoom').value + 'px');
    let filaIndex = 0;
    for (let i = sector.inicio; i <= sector.fin; i += 10) {
      for (let j = i; j < i + 10 && j <= sector.fin; j++) {
        const seat = document.createElement('div');
        seat.className = 'seat';
        seat.dataset.id = j;
        seat.title = `Asiento ${j}`;
        if (filaIndex < 2) {
          seat.textContent = '';
          seat.classList.add('color-azul');
          seat.addEventListener('click', () => mostrarDetalle(seat));
        } else {
          seat.textContent = j;
          seat.addEventListener('click', () => mostrarDetalle(seat));
          if (filaIndex === 12) {
            seat.classList.add('color-azul');
          }
        }
        grid.appendChild(seat);
      }
      filaIndex++;
    }
    sectorDiv.appendChild(header);
    sectorDiv.appendChild(grid);
    sectorsEl.appendChild(sectorDiv);
  });
}
// Modal
function abrirModal() {
  modalDetalle.classList.add('show');
  overlay.classList.add('show');
}
function cerrar() {
  modalDetalle.classList.remove('show');
  overlay.classList.remove('show');
}
// Mostrar detalle de asiento
function mostrarDetalle(seat) {
  const id = seat.dataset.id;
  const registro = Object.values(dataAsistencia).find(info => String(info.asiento) === String(id));
  if (registro && id >= 1 && id <= 205) {
    detalleInfo.innerHTML = `
      <div class="info-grid">
        <span class="info-label">Aspirante:</span>
        <span class="info-value">${registro.aspirante}</span>
        <span class="info-label">Cargo:</span>
        <span class="info-value">${registro.cargo}</span>
        <span class="info-label">Establecimiento:</span>
        <span class="info-value">${registro.establecimiento}</span>
        <span class="info-label">Región:</span>
        <span class="info-value">${registro.region}</span>
        <span class="info-label">Lugar:</span>
        <span class="info-value">Asiento ${registro.asiento} — ${registro.sector}</span>
      </div>
    `;
  } else {
    detalleInfo.innerHTML = `<div style='text-align:center;padding:20px'><p style='color:var(--text-secondary);margin:0'>Asiento sin asignar</p></div>`;
  }
  abrirModal();
}
// Filtros
function filterSeats(mode) {
  document.querySelectorAll('.seat').forEach(seat => {
    const id = seat.dataset.id;
    const registro = Object.values(dataAsistencia).find(info => info.asiento == id);
    let show = true;
    if (mode === 'present') show = registro && registro.presente;
    if (mode === 'absent') show = registro && !registro.presente;
    if (mode === 'empty') show = !registro;
    seat.style.opacity = show ? 1 : 0.2;
  });
}
// Búsqueda
function buscarAsiento(query) {
  document.querySelectorAll('.seat').forEach(seat => seat.classList.remove('highlight'));
  if (!query) return;
  const target = document.querySelector(`.seat[data-id="${query}"]`);
  if (target) {
    target.classList.add('highlight');
    target.scrollIntoView({behavior:'smooth', block:'center', inline:'center'});
  }
}
// Cargar datos de Supabase
async function cargarDatos() {
  try {
    const { data, error } = await supabase
      .from('asistencia')
      .select('*');
    if (error) throw error;
    dataAsistencia = {};
    data.forEach(registro => {
      dataAsistencia[registro.dni] = registro;
    });
    actualizarEstadisticas();
    actualizarAsientosPresentes();
  } catch (error) {
    console.error('Error cargando datos:', error);
  }
}
function actualizarEstadisticas() {
  const total = Object.keys(dataAsistencia).length;
  const presentes = Object.values(dataAsistencia).filter(r => r.presente).length;
  const ausentes = total - presentes;
  kpiTotal.textContent = total;
  kpiPresent.textContent = presentes;
  kpiAbsent.textContent = ausentes;
  kpiOcupa.textContent = total > 0 ? Math.round((presentes / total) * 100) + '%' : '0%';
}
function actualizarAsientosPresentes() {
  document.querySelectorAll('.seat').forEach(seat => {
    const id = seat.dataset.id;
    const registro = Object.values(dataAsistencia).find(info => info.asiento == id);
    seat.classList.remove('presente', 'absent');
    if (registro) {
      if (registro.presente) seat.classList.add('presente');
      else seat.classList.add('absent');
    }
  });
}
// Suscripción tiempo real
function suscribirCambios() {
  supabase
    .channel('panel-changes')
    .on('postgres_changes', 
      { event: '*', schema: 'public', table: 'asistencia' }, 
      (payload) => {
        setTimeout(() => {
          cargarDatos();
        }, 500);
      }
    )
    .subscribe();
}
// Event Listeners
document.getElementById('zoom').addEventListener('input', (e) => {
  document.querySelectorAll('.grid').forEach(grid => {
    grid.style.setProperty('--size', e.target.value + 'px');
  });
});
document.getElementById('filter').addEventListener('change', (e) => {
  filterSeats(e.target.value);
});
document.getElementById('search').addEventListener('input', (e) => {
  buscarAsiento(e.target.value.trim());
});
document.getElementById('btnRefresh').addEventListener('click', cargarDatos);
cerrarModal.addEventListener('click', cerrar);
overlay.addEventListener('click', cerrar);
// Inicialización
document.addEventListener('DOMContentLoaded', () => {
  crearSectores();
  cargarDatos().then(() => {
    vistaJuntaActiva = false;
    document.getElementById('sectors').style.display = 'grid';
    document.getElementById('sectorsJuntas').style.display = 'none';
    crearSectores();
    btnVistaJunta.textContent = 'Vista Sectores Juntos';
    actualizarAsientosPresentes();
    suscribirCambios();
  }).catch((err) => {
    console.error('Error en inicialización:', err);
  });
  setInterval(() => {
    cargarDatos();
  }, 30000);
});
</script>
</body>
</html>